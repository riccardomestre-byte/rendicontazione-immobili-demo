<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestione Rendiconti - Demo Web</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- html2pdf for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <noscript>
    <div style="background:#fee2e2;color:#7f1d1d;padding:10px;text-align:center">JavaScript è disabilitato: la demo non può funzionare.</div>
  </noscript>
  <div id="statusBar" style="background:#0f1627;color:#9fb0c9;padding:8px 24px;font-size:12px"></div>
  <header class="container">
    <div class="brand">
      <div>
        <h1>Gestione Rendiconti (Demo Web)</h1>
        <p>Inserisci Fatturato, Pulizie e Altre spese. I calcoli sono automatici. I dati sono salvati nel tuo browser.</p>
      </div>
      <div class="brand-controls">
        <label class="file">Logo PDF
          <input type="file" id="logoInput" accept="image/*" />
        </label>
        <input id="brandName" type="text" placeholder="Nome Brand per PDF" />
        <input id="brandColor" type="color" value="#487667" title="Colore brand" />
      </div>
    </div>
  </header>

  <main class="container layout">
    <section class="card">
      <h2>1) Immobili</h2>
      <form id="propertyForm" class="grid">
        <input required id="propName" placeholder="Nome immobile" />
        <select id="ownerType">
          <option value="PF">Proprietario PF (con ritenuta 21%)</option>
          <option value="Societa">Società (senza ritenuta)</option>
        </select>
        <label>
          % Commissione gestione
          <input id="commissionPct" type="number" step="0.01" min="0" max="100" value="25" />
        </label>
        <input id="ownerDisplay" placeholder="Nome proprietario per PDF (es. Mario Rossi)" />
        <input id="propAddress" placeholder="Indirizzo immobile (es. Via Roma 1)" />
        <label class="file">Immagine copertina
          <input type="file" id="propCover" accept="image/*" />
        </label>
        <button type="submit" class="btn primary">Aggiungi</button>
      </form>
      <table id="propertyTable" class="table"></table>
      <div id="debugInfo" style="color:var(--muted);margin-top:6px;font-size:12px"></div>
    </section>

    <section class="card">
      <h2>2) Inserimento Mensile</h2>
      <form id="recordForm" class="grid">
        <label>
          Immobile
          <select id="recordProperty"></select>
        </label>
        <label>
          Mese
          <select id="recordMonth"></select>
        </label>
        <label>
          Anno
          <input id="recordYear" type="number" min="2000" max="2100" />
        </label>
        <label>
          AIRBNB (€)
          <input id="airbnb" type="number" step="0.01" min="0" value="0" />
        </label>
        <label>
          Pulizie (€)
          <input id="pulizie" type="number" step="0.01" min="0" value="0" />
        </label>
        <label>
          Altre Spese (€)
          <input id="altreSpese" type="number" step="0.01" min="0" value="0" />
        </label>
        <label style="grid-column:1/-1">
          Note (opzionale)
          <textarea id="notes" rows="3" placeholder="Note per il report (compariranno nel PDF)" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f1627;color:var(--text)"></textarea>
        </label>
        <button type="submit" class="btn primary">Salva mese</button>
      </form>

      <div class="calc" id="calcBox">
        <h3>Anteprima calcoli</h3>
        <div class="calc-grid">
          <div>AIRBNB</div><div id="c_airbnb">0,00</div>
          <div>Pulizie</div><div id="c_pulizie">0,00</div>
          <div>Altre spese</div><div id="c_altre">0,00</div>
          <div><strong>Corrispettivo Locazione</strong></div><div id="c_locazione">0,00</div>
          <div>Commissione gestione</div><div id="c_comm">0,00</div>
          <div>IVA 22%</div><div id="c_iva">0,00</div>
          <div><strong>Corrispettivo netto</strong></div><div id="c_netto">0,00</div>
          <div>Ritenuta 21%</div><div id="c_rit">0,00</div>
          <div class="total"><strong>Netto da bonificare</strong></div><div class="total" id="c_bonifico">0,00</div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>3) Dashboard Annuale</h2>
      <div class="toolbar">
        <label>
          Immobile
          <select id="dashProperty"></select>
        </label>
        <label>
          Anno
          <input id="dashYear" type="number" min="2000" max="2100" />
        </label>
        <button class="btn" id="refreshDash">Aggiorna</button>
        <button class="btn" id="downloadPDF">Scarica PDF mese selezionato</button>
        <button class="btn" id="previewPDF">Anteprima PDF (dai campi)</button>
        <label class="btn" for="csvInput">Importa CSV</label>
        <input type="file" id="csvInput" accept=".csv,text/csv" style="display:none" />
        <a id="csvTemplate" class="btn" href="#">Scarica template CSV</a>
        <button class="btn" id="resetData">Reset dati demo</button>
        <button class="btn" id="showDiag">Diagnostica</button>
      </div>

      <div id="annualTable"></div>
      <canvas id="annualChart" height="120"></canvas>
    </section>

    <section class="card" id="pdfContainer" style="display:none"></section>
  </main>

  <footer class="container">
    <small>Demo senza backend. I dati vengono salvati in <code>localStorage</code> del browser.</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
